```sql
mysql> select * from T where ID=10；
```
有一个简单的表T，其中只有一条ID为10的数据，则在执行上述sql语句时会经历如下过程：
![](MySQL的逻辑架构图.png)
这是MySQL的逻辑架构图，MySQL分为Server层和存储引擎层。

Server层涵盖MySQL的大多数服务功能，包括所有的内置函数。

存储引擎层负责数据的存储和提取。结构模式为插件式，支持InnoDB、MyISAM、Memory等多个存储引擎。

# 连接器
在客户端与服务端间建立连接，其中包括了TCP三次握手。
```sql
mysql -h localhost -P 3306 -u root -p
show processlist
```
# 查询缓存
select语句的执行逻辑会先查询缓存，看下之前是否有执行过这个语句。如果执行过，则会以键值对的形式存在内存中，下次再执行时直接返回缓存中的结果，这叫命中缓存。如果没有执行过，则为命中缓存，需要执行下面的步骤。
```sql
mysql> select SQL_CACHE * from T where ID=10；
```

但是当表更新时，缓存就会失效。所以如果表频繁更新，不建议使用查询缓存。

# 分析器
检查该sql语句是否有词法错误，如果无误则进行语法解析，知道这是一条什么语句（查询、更新等），然后进入下一步骤。分析器负责告知优化器要“做什么”。

# 优化器
知道了要做什么后，优化器的使命就是制定出更加高效的执行方式来实现所需功能。即告诉执行器要“怎么做”。
```sql
mysql> select * from t1 join t2 using(ID)  where t1.c=10 and t2.d=20;
```

# 执行器
接收优化器发给自己的执行计划，开始执行。

如果发现自己没有访问这个数据的权限，则会报错。
```sql
mysql> select * from T where ID=10;

ERROR 1142 (42000): SELECT command denied to user 'b'@'localhost' for table 'T'
```

如果有权限，就根据这个表的引擎定义，去调用这个引擎提供的接口。

这个ID没有索引，其执行过程如下：
1. 调用InnoBD引擎接口取T的第一行，从表T的第一行开始遍历
2. 如果ID不为10，则调用引擎接口接着遍历下一行；如果为10，则将该行数据加入结果集，然后遍历下一行
3. 反复执行上个步骤，直至最后一行。将所有满足条件的结果集返回。

如果T有索引，其执行过程如下：
1. 调用“取满足条件的第一行”引擎接口
2. 循环调用“取满足条件的下一行”这个接口，直至所有的都取完。
