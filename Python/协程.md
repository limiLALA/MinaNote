# 协程

>[Python GIL全局解释器锁详解（深度剖析）](http://c.biancheng.net/view/5537.html)  
[Python协程的多种实现（Tornado、Greenlet、Eventlet、Gevent）（Worker的多种工作方式）](https://zhu327.github.io/2016/06/16/python%E5%8D%8F%E7%A8%8B/)


# 猴子补丁monkey patch
猴子补丁的思路是在进程运行的时候把标准库中的thread/socket/sys/httplib/subprocess等模块的实现替换成非阻塞式的，而后面不需要改动任何代码，像往常一样使用即可，这种操作仅支持动态语言，比如python。

猴子补丁的核心是通过诸如下面这样的操作来实现模块的替换
```python
del sys.modules['socket']
sys.modules['socket'] = **import**('gevent._socket3')
```

>[源码分析之gevent monkey.patch_all实现原理](http://xiaorui.cc/archives/3248)

## gevent
python通过yield提供了对协程的基本支持，但是不完全。第三方的gevent提供了较为完善的异步协程支持，通过greenlet实现协程。当进行IO操作时，当前greenlet会自动交出线程的控制权，由下一个空闲的greenlet接替。无论开多少个协程，实际上只有一个线程在跑。  
由于gevent无法捕获普通的耗时操作（同步阻塞式调用），导致无法切换协程去执行，只能一直傻傻等待，这时多开协程便失去了意义，需要在进程刚开始启动的时候打上猴子补丁，即执行gevent的monkey.patch_all()，将所有的同步阻塞式的module替换成异步非阻塞式的module，此时当遇上耗时操作（如发送http请求）时，会直接切换到其他协程去执行。

## eventlet
与gevent类似，eventlet是一个用于python并发编程的库，它用python实现了自己的调度器Hub，支持在pypy上运行。但是gevent为了提升效率，通过Cython调用libev实现了一个高效的event loop事件调度循环，因此gevent目前使用最为方便的协程。
