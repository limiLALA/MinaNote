# 大规模分布式存储架构
## PaxosStore是什么
一个在跨园区数据中心见同步复制，提供灵活的数据模式和访问接口并支持单标亿行，具备快速伸缩能力，降低延迟低成本，强一致个高可用的分布式存储系统。

## PaxosStore特点
* 无租约Paxos工程化，多主多写，可用性达到6个9
* 针对业务特性优化，合并整体优化成本15+%
* 同一容灾，迁移框架下，支持多种插件化存储引擎、亿行大表
* 快速伸缩能力，基于反馈的自适应迁移系统（系统可从几十台扩展到几百台任意规模）

## 广泛支持微信在线应用
个人信息、通讯录、朋友圈、聊天记录、订阅号消息、群聊消息等都是存在PaxosStore

## 部署情况
* WXG内部广泛部署，数千台机器
* 数万亿/天的读写量，峰值1亿+/秒
* 1PB+的结构化数据，全球多个数据中心
* 世界上基于Paxos最大的线上存储系统？

## 摘要
### WXG为啥需要PaxosStore
* 更高可用性要求：
  * 频繁单机故障：近200台/月，机器数1万+
  * 偶发网络分区：跨园区部署
  * 海量用户：10亿—+
* 消息树一年半内增长15倍，成本优化需求迫切
* 大表的需求：千万行、丰富API、扩展性、一致性视图

## PaxosStore设计
### 功能介绍
#### 总体架构
Client（发送读写请求）
读写副本（园区1）
同步复制组件
存储引擎插件
迁移系统、备份系统、路由中心
#### 数据模型
* 键值
* 队列
* 集合
* 二维小表
* 大表：支持小表所有功能，而且支持二级索引，千万级行
#### 数据备份
* 冷备：定期完整备份（快照）
* 热备：事务日志的增量备份
### 可用性
#### 复制策略
* 复制策略
  * 异步主/备复制
  * 同步主/备复制
  * 乐观复制
* Paxos：容错、无主的一致性算法
  * 同步复制操作日志
  * 多主多写
  * 一致性视图、ACID语义
  * 多个复制日志提升吞吐量和可用性
#### 性能优化
* Paxos协议优化：预授权
* 网络IO按IP聚合投递
* 针对只复制副本，延迟批量Commit（削峰填谷）
### 可扩展性
### 存储引擎
